<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>{{ university_name|capitalize }} foydalanuvchilari</title>

  <!-- Tailwind (+ forms) -->
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <script>
    tailwind.config = {
      darkMode:'class',
      theme:{
        extend:{
          keyframes:{
            'slide-in-left':{'0%':{transform:'translateX(-100%)',opacity:'0'},'100%':{transform:'translateX(0)',opacity:'1'}},
            'slide-out-left':{'0%':{transform:'translateX(0)',opacity:'1'},'100%':{transform:'translateX(-100%)',opacity:'0'}},
            'fade-in-up':{'0%':{opacity:'0',transform:'translateY(8px) scale(.98)'},
                          '100%':{opacity:'1',transform:'translateY(0) scale(1)'}},
            'scale-in':{'0%':{opacity:'0',transform:'scale(.96)'},'100%':{opacity:'1',transform:'scale(1)'}},
            'slide-up':{'0%':{transform:'translateY(10px)',opacity:'0'},'100%':{transform:'translateY(0)',opacity:'1'}},
            'fade-out':{'0%':{opacity:'1'},'100%':{opacity:'0'}}
          },
          animation:{
            'slide-in-left':'slide-in-left .32s cubic-bezier(.22,1,.36,1) both',
            'slide-out-left':'slide-out-left .26s cubic-bezier(.4,0,.2,1) both',
            'fade-in-up':'fade-in-up .35s cubic-bezier(.22,1,.36,1) both',
            'scale-in':'scale-in .24s cubic-bezier(.22,1,.36,1) both',
            'slide-up':'slide-up .28s cubic-bezier(.22,1,.36,1) both',
            'fade-out':'fade-out .2s ease both'
          }
        }
      }
    };
  </script>

  <!-- Boshlanishda dark rejimni qo'llash -->
  <script>
    if (
      localStorage.theme === 'dark' ||
      (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) { document.documentElement.classList.add('dark'); }
  </script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    /* Jadval hover effekti */
    tbody tr{ transition: background .2s, box-shadow .2s; }
    tbody tr:hover{ background:#f1f5f9; box-shadow:0 2px 8px rgba(0,0,0,.04); }
    .dark tbody tr:hover{ background:#23293a; }

    /* prefers-reduced-motion */
    @media (prefers-reduced-motion:reduce){
      *{ animation:none !important; transition:none !important; }
    }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 min-h-screen flex flex-col dark:text-white"
      id="pageRoot" data-university="{{ university_name }}">

  <!-- Safelist helper (Tailwind anim. tree-shake bo'lmasligi uchun) -->
  <div class="hidden opacity-0 animate-slide-in-left animate-slide-out-left animate-fade-in-up animate-scale-in animate-slide-up"></div>

  <!-- Topbar -->
  <header class="flex items-center justify-between bg-white dark:bg-gray-800 shadow px-6 py-4 animate-slide-up">
    <div class="flex items-center gap-3">
      <a href="/link_login/{{ university_name }}"
         class="px-3 py-1 rounded bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition inline-flex items-center gap-2">
        <i data-lucide="arrow-left" class="w-4 h-4"></i>
        <span>Orqaga</span>
      </a>
      <h2 class="text-xl font-bold text-gray-700 dark:text-white">
        {{ university_name|capitalize }} — Foydalanuvchilar
      </h2>
    </div>

    <div class="flex items-center gap-3">
      <div class="relative">
        <i data-lucide="search" class="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        <input id="searchInput"
               class="pl-9 pr-3 py-2 rounded-lg border border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-400 transition w-64"
               placeholder="Qidirish... (MAC, Telefon, FIO, Role)" autocomplete="off"/>
      </div>

      <!-- Theme toggle (sun/moon) -->
      <button id="themeToggle"
              class="w-10 h-10 rounded-full flex items-center justify-center bg-gray-200 dark:bg-gray-700 focus:outline-none active:scale-95 transition"
              title="Tungi/Yorug' rejim">
        <span id="themeIconSun" class="hidden"><i data-lucide="sun" class="w-6 h-6 text-gray-600 dark:text-white"></i></span>
        <span id="themeIconMoon"><i data-lucide="moon" class="w-6 h-6 text-gray-600 dark:text-white"></i></span>
      </button>
    </div>
  </header>

  <!-- Content -->
  <main class="flex-1 p-6 overflow-x-auto">
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 max-w-7xl mx-auto animate-fade-in-up">
      <div class="overflow-x-auto rounded-xl border border-gray-200 dark:border-gray-700 shadow">
        <table class="min-w-full text-sm">
          <thead>
            <tr class="bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-200 text-xs text-left uppercase">
              <th class="px-3 py-2 cursor-pointer sort" data-sort="id">ID ⬍</th>
              <th class="px-3 py-2 cursor-pointer sort" data-sort="mac">MAC ⬍</th>
              <th class="px-3 py-2 cursor-pointer sort" data-sort="fio">FIO ⬍</th>
              <th class="px-3 py-2 cursor-pointer sort" data-sort="phone">Telefon ⬍</th>
              <th class="px-3 py-2 cursor-pointer sort" data-sort="role">Role ⬍</th>
              <th class="px-3 py-2 cursor-pointer sort" data-sort="last_authorization">Oxirgi avtorizatsiya ⬍</th>
              <th class="px-3 py-2">Batafsil</th>
            </tr>
          </thead>
          <tbody id="userTableBody" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="flex flex-col md:flex-row md:justify-between md:items-center mt-6 gap-4">
        <span class="text-xs dark:text-white">JAMI: <span id="userCount">0</span></span>

        <div class="flex items-center gap-3">
          <label class="text-xs">Limit:</label>
          <select id="limitSelect" class="rounded-lg border px-2 py-1 dark:bg-gray-900 dark:text-white">
            <option value="10">10</option>
            <option value="20" selected>20</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>

          <div class="flex items-center gap-2 ml-4">
            <button id="prevBtn" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition">&lt;</button>
            <span id="pageInfo" class="text-sm"></span>
            <button id="nextBtn" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition">&gt;</button>
          </div>

          <div class="flex items-center gap-2 ml-4">
            <label class="text-xs">Go to page:</label>
            <input type="number" id="pageInput" min="1" class="w-16 rounded-lg border px-2 py-1 dark:bg-gray-900 dark:text-white">
            <button id="goBtn" class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition">Go</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Socket.IO client -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script src="{{ url_for('static', filename='js/link_login_users.js') }}"></script>

  <!-- Theme & Icons JS -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Lucide icons
      if (window.lucide && lucide.createIcons) { lucide.createIcons(); }

      // Theme toggle (sun/moon)
      const themeToggle = document.getElementById('themeToggle');
      const sunWrap = document.getElementById('themeIconSun');
      const moonWrap = document.getElementById('themeIconMoon');

      function setTheme(mode){
        if(mode==='dark'){
          document.documentElement.classList.add('dark');
          localStorage.setItem('theme','dark');
          sunWrap && sunWrap.classList.remove('hidden');
          moonWrap && moonWrap.classList.add('hidden');
        }else{
          document.documentElement.classList.remove('dark');
          localStorage.setItem('theme','light');
          sunWrap && sunWrap.classList.add('hidden');
          moonWrap && moonWrap.classList.remove('hidden');
        }
      }

      const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      setTheme(savedTheme);

      themeToggle && themeToggle.addEventListener('click', () => {
        const next = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
        setTheme(next);
      });
    });
  </script>
</body>
</html>
